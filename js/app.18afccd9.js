(function(){var t={7396:function(t,e,i){"use strict";var s=i(9963),n=i(3245),a=(i(2467),i(6252)),r=i(2262),o=i(3577),l=i(1446),c=i(1574),h=i(515);function _(t){(0,a.bv)((()=>window.addEventListener("resize",t,!1))),(0,a.Ah)((()=>window.removeEventListener("resize",t,!1)))}const u=["fill"];var d=(0,a.aZ)({props:{width:{default:window.innerWidth},height:{default:window.innerHeight},wave:{default:1},peak:{default:.5},level:{default:.5},color:{default:"#000000"},period:{default:300}},setup(t){const e=t,i=(0,a.Fl)((()=>h(1*e.peak))),s=(0,a.Fl)((()=>h(-1*e.peak))),n=(0,a.Fl)((()=>Math.round((e.period||300)+500*Math.random()))),l=(0,a.Fl)((()=>e.height*(1-e.level))),c=(0,a.Fl)((()=>[`--d0: path('${i.value}')`,`--d1: path('${s.value}')`,`--period: ${n.value}ms`,`transform: translateY(${l.value}px)`].join(";")));function h(t){const{wave:i,width:s,height:n}=e,a=0,r=s/i,o=r*Math.random(),l=[`M ${-o} ${a}`];for(let e=0;e<i+1;e++){const i=.25*r*t*(e%2?1:-1),s=`${r*(e+.5)-o} ${a+i}`,n=`${r*(e+1)-o} ${a}`;l.push(`C ${s}, ${s}, ${n}`)}return l.push(`L ${s} ${2*n} L 0 ${2*n} Z`),l.join(" ")}return(e,i)=>((0,a.wg)(),(0,a.iD)("path",{class:(0,o.C_)(e.$style.path),style:(0,o.j5)((0,r.SU)(c)),fill:t.color},null,14,u))}}),E={path:"SonicViewShape_path_a7f8b",sonic:"SonicViewShape_sonic_ff95e"},f=i(3744);const S={};S["$style"]=E;const p=(0,f.Z)(d,[["__cssModules",S]]);var w=p,g=(0,a.aZ)({props:{peak:null,level:null,period:null},setup(t){const e=t,i=(0,r.iH)(window.innerWidth),s=(0,r.iH)(window.innerHeight);return _((()=>{i.value=window.innerWidth,s.value=window.innerHeight})),(t,n)=>((0,a.wg)(),(0,a.iD)("svg",{class:(0,o.C_)(t.$style.sonic)},[(0,a.Wm)(w,{width:i.value,height:s.value,peak:e.peak,wave:Math.round(i.value/640*2),level:e.level,period:e.period,color:"#50E3C2FF"},null,8,["width","height","peak","wave","level","period"]),(0,a.Wm)(w,{width:i.value,height:s.value,peak:e.peak,wave:Math.round(i.value/640*3),level:e.level,period:e.period,color:"#46DBBAB2"},null,8,["width","height","peak","wave","level","period"]),(0,a.Wm)(w,{width:i.value,height:s.value,peak:e.peak,wave:Math.round(i.value/640*5),level:e.level,period:e.period,color:"#47CCC2CC"},null,8,["width","height","peak","wave","level","period"])],2))}}),v={sonic:"SonicView_sonic_f1729"};const m={};m["$style"]=v;const A=(0,f.Z)(g,[["__cssModules",m]]);var L=A,y=(i(4633),i(9539)),I=i(7766),T=i(5001),b=i(4155),Z=i(8764)["Buffer"];const P=(0,y.promisify)(I.FY);function U(t){return new Promise((e=>{const i=i=>{t.removeListener("end",s),e(i)},s=()=>{t.removeListener("entry",i),e(null)};t.once("entry",i),t.once("end",s),t.readEntry()}))}async function C(t){const e=Z.from(await t.arrayBuffer()),i=await P(e,{lazyEntries:!0}),s=(0,y.promisify)(i.openReadStream.bind(i)),n={};let a;while(null!=(a=await U(i))){if(a.fileName.endsWith("/"))continue;const t=await s(a);n[`/${a.fileName}`]=await(0,T.Z)(t).spoon()}return n}window.setImmediate=b.nextTick;var F=i(8764)["Buffer"];async function B(t){const e=await C(t),{dir:i,content:s}=M(e)||{};if(!s)return null;const n=F.from(s).toString().replace(/\n/g," ").split(" ").map((t=>t.trim())).filter((t=>!!t)),a={flashMode:"qio",partitions:[]};for(let r=0;r<n.length-1;r++)if("--flash_mode"==n[r])a.flashMode=n[r+1];else if(n[r].match(/^0x([A-Fa-f0-9]+)$/)){const t=parseInt(RegExp.$1,16),s=`${i}/${n[r+1]}`;e[s]&&a.partitions.push({address:t,image:e[s]})}else if(n[r].match(/^([0-9]+)$/)){const t=parseInt(RegExp.$1),s=`${i}/${n[r+1]}`;e[s]&&a.partitions.push({address:t,image:e[s]})}return a}function M(t){for(const e in t)if(e.match(/^(.*)\/flash_args$/))return{dir:RegExp.$1,content:t[e]};return null}var k=i(2482),$=(i(1703),i(7187)),H=i.n($),R=i(2635),D=i.n(R);function O(t,e=1){return`0x${t.toString(16).padStart(2*e,"0")}`}async function G(t,e,i){return new Promise(((s,n)=>{const a=t=>{clearTimeout(r),s(t)},r=setTimeout((()=>{t.removeListener(e,a),n(new Error("Timeout"))}),i);t.once(e,a)}))}function N(t){return new Promise((e=>setTimeout(e,t)))}var W=i(8764)["Buffer"];function x(t){const e=W.alloc(2*t.length+2);e[0]=192;let i=1;for(let s=0;s<t.length;s++)192==t[s]?(e[i]=219,e[i+1]=220,i+=2):219==t[s]?(e[i]=219,e[i+1]=221,i+=2):(e[i]=t[s],i+=1);return e[i]=192,e.slice(0,i+1)}var j=i(8764)["Buffer"];function z(t,e){t=j.concat([t,e]);const i=[];let s=0,n=0,a=null;while(n<t.length)192==t[n]?(null==a?a=j.alloc(t.length):(i.push(a.slice(0,s)),a=null,s=0),n+=1):n<t.length-1&&219==t[n]&&220==t[n+1]?(null!=a&&(a[s]=192,s+=1),n+=2):n<t.length-1&&219==t[n]&&221==t[n+1]?(null!=a&&(a[s]=219,s+=1),n+=2):(null!=a&&(a[s]=t[n],s+=1),n+=1);return a=null!=a?j.concat([j.from([192]),a.slice(0,s)]):j.alloc(0),{queue:a,packets:i}}var K=i(8764)["Buffer"];const q=(0,y.promisify)(D().unzip),Y=(0,y.promisify)(D().deflate),V="dataTerminalReady",J="requestToSend";class X{constructor(t){(0,k.Z)(this,"CHIP_NAME","Espressif device"),(0,k.Z)(this,"IS_STUB",!1),(0,k.Z)(this,"COMPRESS",!0),(0,k.Z)(this,"ESP_FLASH_BEGIN",2),(0,k.Z)(this,"ESP_FLASH_DATA",3),(0,k.Z)(this,"ESP_FLASH_END",4),(0,k.Z)(this,"ESP_MEM_BEGIN",5),(0,k.Z)(this,"ESP_MEM_END",6),(0,k.Z)(this,"ESP_MEM_DATA",7),(0,k.Z)(this,"ESP_SYNC",8),(0,k.Z)(this,"ESP_READ_REG",10),(0,k.Z)(this,"ESP_FLASH_DEFL_BEGIN",16),(0,k.Z)(this,"ESP_FLASH_DEFL_DATA",17),(0,k.Z)(this,"ESP_FLASH_DEFL_END",18),(0,k.Z)(this,"ESP_SPI_ATTACH",13),(0,k.Z)(this,"ESP_CHANGE_BAUDRATE",15),(0,k.Z)(this,"ESP_RAM_BLOCK",6144),(0,k.Z)(this,"FLASH_WRITE_SIZE",1024),(0,k.Z)(this,"ESP_IMAGE_MAGIC",233),(0,k.Z)(this,"ESP_CHECKSUM_MAGIC",239),(0,k.Z)(this,"FLASH_SECTOR_SIZE",4096),(0,k.Z)(this,"STATUS_BYTES_LENGTH",2),(0,k.Z)(this,"BOOTLOADER_FLASH_OFFSET",0),(0,k.Z)(this,"FLASH_SIZES",{}),(0,k.Z)(this,"USB_JTAG_SERIAL_PID",4097),(0,k.Z)(this,"port",void 0),(0,k.Z)(this,"reader",void 0),(0,k.Z)(this,"dispatcher",void 0),(0,k.Z)(this,"queue",void 0),(0,k.Z)(this,"usb_jtag_serial",!1),(0,k.Z)(this,"STUB_CLASS",void 0),(0,k.Z)(this,"_trace",void 0),this.port=t,this.dispatcher=new(H()),this.queue=K.alloc(0),this._trace=X.TRACE?t=>console.log(`%cTRACE ${t}`,"color: darkcyan"):()=>null}start(){this._read()}async release(){this.reader&&await this.reader.cancel()}async _read(){if(!this.port?.readable)return;const t=this.reader=this.port.readable.getReader();try{while(this.reader){const{value:e,done:i}=await t.read();if(!e||i)break;const s=K.from(e);this._trace(`Read ${s.length} bytes: ${s.toString("hex")}`);const{queue:n,packets:a}=z(this.queue,s);this.queue=n;for(const t of a)this._dispatch(t)}}finally{t.releaseLock(),delete this.reader}}async _write(t){t=x(t),this._trace(`Write ${t.length} bytes: ${t.toString("hex")}`);const e=this.port.writable?.getWriter();e&&(await e.write(t),e.releaseLock())}_dispatch(t){if(t.length<8)return;if(1!=t[0])return;const e=t[1],i=t.readUInt16LE(2),s=t.readUInt32LE(4);t=t.slice(8),this._trace(`< res op=${O(e)} len=${i} val=${s} data=${t.toString("hex")}`),this.dispatcher.emit(`res:${e}`,{val:s,data:t})}async command(t,e,i=0,s=500,n=5){this._trace(`> req op=${O(t)} len=${e.length} data=${e.toString("hex")}`);const a=K.alloc(8);a[0]=0,a[1]=t,a.writeUInt16LE(e.length,2),a.writeUInt32LE(i,4);const r=K.concat([a,e]);for(let l=0;l<n;l++)try{return await this._write(r),await G(this.dispatcher,`res:${t}`,s)}catch(o){}throw new Error("Timeout waiting for command response")}check({val:t,data:e}){if(e.length<this.STATUS_BYTES_LENGTH)throw new Error(`Only got ${e.length} byte status response.`);const i=e.slice(0,this.STATUS_BYTES_LENGTH);if(0!=i[0])throw new Error(`Command failed: ${i.toString("hex")}`);return e.length>this.STATUS_BYTES_LENGTH?e.slice(this.STATUS_BYTES_LENGTH):t}async sync(){const t=K.concat([K.from([7,7,18,32]),K.alloc(32,85)]),{val:e}=await this.command(this.ESP_SYNC,t);return e}async _bootloader_reset(t=!1){await(this.port?.setSignals({[V]:!1,[J]:!0})),await N(100),t&&await N(1200),await(this.port?.setSignals({[V]:!0,[J]:!1})),t&&await N(400),await N(50),await(this.port?.setSignals({[V]:!1,[J]:!1}))}async _bootloader_reset_usb(){await(this.port?.setSignals({[V]:!0,[J]:!1})),await N(100),await(this.port?.setSignals({[V]:!1,[J]:!0})),await N(100),await(this.port?.setSignals({[V]:!1,[J]:!1}))}async _connect_attempt(t=!1){this.usb_jtag_serial?await this._bootloader_reset_usb():await this._bootloader_reset(t);for(let i=0;i<5;i++)try{return await this.sync(),!0}catch(e){await N(50)}return!1}async connect(t=7){this.port?.getInfo()?.usbProductId==this.USB_JTAG_SERIAL_PID&&(this.usb_jtag_serial=!0,console.log("Detected integrated USB Serial/JTAG"));for(let i=0;i<t;i++)try{if(await this._connect_attempt(!1))return!0;if(await this._connect_attempt(!0))return!0}catch(e){}return!1}async read_reg(t){const e=K.alloc(4);e.writeUInt32LE(t,0);const{val:i}=await this.command(this.ESP_READ_REG,e);return i}async get_chip_description(){throw new Error("Not supported")}get_erase_size(t,e){return e}_checksum(t){let e=this.ESP_CHECKSUM_MAGIC;for(const i of t)e^=i;return e}async mem_begin(t,e,i,s){const n=K.alloc(16);n.writeUInt32LE(t,0),n.writeUInt32LE(e,4),n.writeUInt32LE(i,8),n.writeUInt32LE(s,12),this.check(await this.command(this.ESP_MEM_BEGIN,n,0,5e3,1))}async mem_block(t,e){const i=K.alloc(16);i.writeUInt32LE(t.length,0),i.writeUInt32LE(e,4),i.writeUInt32LE(0,8),i.writeUInt32LE(0,12);const s=K.concat([i,t]);this.check(await this.command(this.ESP_MEM_DATA,s,this._checksum(t),5e3,1))}async mem_finish(t=0){const e=K.alloc(8);e.writeUInt32LE(0==t?1:0,0),e.writeUInt32LE(t,4),this.check(await this.command(this.ESP_MEM_END,e,0,50,1))}async flash_begin(t,e){const i=Math.floor((t+this.FLASH_WRITE_SIZE-1)/this.FLASH_WRITE_SIZE),s=this.get_erase_size(e,t),n=K.alloc(16);return n.writeUInt32LE(s,0),n.writeUInt32LE(i,4),n.writeUInt32LE(this.FLASH_WRITE_SIZE,8),n.writeUInt32LE(e,12),this.check(await this.command(this.ESP_FLASH_BEGIN,n,0,5e3,1)),i}async flash_block(t,e){const i=K.alloc(16);i.writeUInt32LE(t.length,0),i.writeUInt32LE(e,4),i.writeUInt32LE(0,8),i.writeUInt32LE(0,12);const s=K.concat([i,t]);this.check(await this.command(this.ESP_FLASH_DATA,s,this._checksum(t),5e3,1))}async flash_finish(t=!1){const e=K.alloc(4);e.writeUInt32LE(t?0:1,0),this.check(await this.command(this.ESP_FLASH_END,e))}async flash_defl_begin(t,e,i){const s=Math.floor((e+this.FLASH_WRITE_SIZE-1)/this.FLASH_WRITE_SIZE),n=Math.floor((t+this.FLASH_WRITE_SIZE-1)/this.FLASH_WRITE_SIZE),a=this.IS_STUB?t:n*this.FLASH_WRITE_SIZE;console.log(`Comporessed ${t} bytes to ${e}...`);const r=K.alloc(16);return r.writeUInt32LE(a,0),r.writeUInt32LE(s,4),r.writeUInt32LE(this.FLASH_WRITE_SIZE,8),r.writeUInt32LE(i,12),this.check(await this.command(this.ESP_FLASH_DEFL_BEGIN,r,0,5e3,1)),s}async flash_defl_block(t,e){const i=K.alloc(16);i.writeUInt32LE(t.length,0),i.writeUInt32LE(e,4),i.writeUInt32LE(0,8),i.writeUInt32LE(0,12);const s=K.concat([i,t]);this.check(await this.command(this.ESP_FLASH_DEFL_DATA,s,this._checksum(t),5e3,1))}async flash_defl_finish(t=!1){const e=K.alloc(4);e.writeUInt32LE(t?0:1,0),this.check(await this.command(this.ESP_FLASH_DEFL_END,e))}_pad_image(t,e,i=255){const s=t.length%e;return 0!=s&&(t=K.concat([t,K.alloc(s,i)])),t}_parse_flash_size_arg(t){if(this.FLASH_SIZES[t])return this.FLASH_SIZES[t];{const e=Object.keys(this.FLASH_SIZES).join(", ");throw new Error(`Flash size '${t}' is not supported by this chip type. Supported sizes: ${e}`)}}async load_stub(){return null}async run_stub(){const t=await this.load_stub();if(!t)return null;console.log("Uploading stub...");for(const e of["text","data"]){if(!t[e])continue;const i=t[`${e}_start`],s=await q(K.from(t[e],"base64")),n=Math.floor((s.length+this.ESP_RAM_BLOCK-1)/this.ESP_RAM_BLOCK);await this.mem_begin(s.length,n,this.ESP_RAM_BLOCK,i);for(let t=0;t<n;t++){const e=t*this.ESP_RAM_BLOCK,i=e+this.ESP_RAM_BLOCK;await this.mem_block(s.slice(e,i),t)}}return console.log("Running stub..."),await this.mem_finish(t["entry"]),await N(500),console.log("Stub running..."),new this.STUB_CLASS(this.port)}async change_baud(t,e){console.log(`Changing baud rate from ${e} to ${t}`);const i=K.alloc(8);i.writeUInt32LE(t,0),i.writeUInt32LE(this.IS_STUB?e:0,4),await this.command(this.ESP_CHANGE_BAUDRATE,i),console.log("Changed.")}_update_image_flash_params(t,e,i){if(t!=this.BOOTLOADER_FLASH_OFFSET)return i;const s=i[0];let n=i[2],a=15&i[3],r=240&i[3];return s!=this.ESP_IMAGE_MAGIC?(console.warn(`Warning: Image file at ${t} doesn't look like an image file, so not changing any flash settings.`),i):(e.flashMode&&"keep"!=e.flashMode&&(n={qio:0,qout:1,dio:2,dout:3}[e.flashMode]),e.flashFreq&&"keep"!=e.flashFreq&&(a={"40m":0,"26m":1,"20m":2,"80m":15}[e.flashFreq]),e.flashSize&&"keep"!=e.flashSize&&(r=this._parse_flash_size_arg(e.flashSize)),i[2]=n,i[3]=a|r,i)}async flash(t,e){for(let i=0;i<t.partitions.length;i++){const{address:s}=t.partitions[i];let n,{image:a}=t.partitions[i];if(console.log(`Part ${i}: address=${O(s,4)} size=${a.length}`),a=this._pad_image(a,4),0==a.length){console.warn(`Skipped empty part ${i} address=${O(s,4)}`);continue}if(a=this._update_image_flash_params(s,t,a),this.COMPRESS){const t=a.length;a=await Y(a,{level:9}),n=await this.flash_defl_begin(t,a.length,s)}else n=await this.flash_begin(a.length,s);let r=0,o=0;while(a.length>0){const t=a.slice(0,this.FLASH_WRITE_SIZE);this.COMPRESS?(console.log(`Writing... (${Math.round((r+1)/n*100)}%)`),await this.flash_defl_block(t,r)):(console.log(`Writing at ${O(s+o,4)}... (${Math.round((r+1)/n*100)}%)`),await this.flash_block(t,r)),a=a.slice(this.FLASH_WRITE_SIZE),r+=1,o+=t.length,e({index:i,blocks_written:r+1,blocks_total:n})}this.IS_STUB&&await this.read_reg(X.CHIP_DETECT_MAGIC_REG_ADDR),console.log(`Wrote ${o} bytes`)}console.log("Leaving..."),this.IS_STUB&&(await this.flash_begin(0,0),this.COMPRESS?await this.flash_defl_finish(!1):await this.flash_finish(!1))}async hard_reset(){await(this.port?.setSignals({[V]:!1,[J]:!0})),await N(100),await(this.port?.setSignals({[V]:!1,[J]:!1}))}}(0,k.Z)(X,"TRACE",!1),(0,k.Z)(X,"CHIP_DETECT_MAGIC_REG_ADDR",1073745920);class Q extends X{constructor(...t){super(...t),(0,k.Z)(this,"CHIP_NAME","ESP8266"),(0,k.Z)(this,"IS_STUB",!1),(0,k.Z)(this,"FLASH_SIZES",{"512KB":0,"256KB":16,"1MB":32,"2MB":48,"4MB":64,"2MB-c1":80,"4MB-c1":96,"8MB":128,"16MB":144}),(0,k.Z)(this,"BOOTLOADER_FLASH_OFFSET",0),(0,k.Z)(this,"STUB_CLASS",tt)}async load_stub(){return await i.e(468).then(i.t.bind(i,450,23))}async get_efuses(){return[await this.read_reg(1072693328),await this.read_reg(1072693332),await this.read_reg(1072693336),await this.read_reg(1072693340)]}_get_flash_size(t){const e=16&t[0],i=t[3]&1<<25,s=t[3]&1<<26,n=t[3]&1<<27;if(e&&!i){if(!n&&!s)return 1;if(!n&&s)return 2}if(!e&&i){if(!n&&!s)return 2;if(!n&&s)return 4}return-1}async get_chip_description(){const t=await this.get_efuses();if(16&t[0]||65536&t[2]){const e=this._get_flash_size(t),i=32&t[0],s={1:i?"ESP8285H08":"ESP8285N08",2:i?"ESP8285H16":"ESP8285N16"}[e]||"ESP8285";return s}return"ESP8266EX"}get_erase_size(t,e){const i=16,s=this.FLASH_SECTOR_SIZE,n=Math.floor((e+s-1)/s),a=Math.floor(t/s);let r=i-a%i;return n<r&&(r=n),n<2*r?Math.floor((n+1)/2)*s:(n-r)*s}}(0,k.Z)(Q,"CHIP_DETECT_MAGIC_VALUE",[4293968129]);class tt extends Q{constructor(...t){super(...t),(0,k.Z)(this,"FLASH_WRITE_SIZE",16384),(0,k.Z)(this,"IS_STUB",!0)}get_erase_size(t,e){return e}}class et extends X{constructor(...t){super(...t),(0,k.Z)(this,"CHIP_NAME","ESP32"),(0,k.Z)(this,"IS_STUB",!1),(0,k.Z)(this,"STATUS_BYTES_LENGTH",4),(0,k.Z)(this,"EFUSE_BLK0",1073061888),(0,k.Z)(this,"DR_REG_SYSCON_BASE",1073111040),(0,k.Z)(this,"FLASH_SIZES",{"1MB":0,"2MB":16,"4MB":32,"8MB":48,"16MB":64}),(0,k.Z)(this,"BOOTLOADER_FLASH_OFFSET",4096),(0,k.Z)(this,"STUB_CLASS",it)}async load_stub(){return await i.e(458).then(i.t.bind(i,2699,23))}async read_efuse(t,e){return await this.read_reg(t+4*e)}async get_pkg_version(){const t=await this.read_efuse(this.EFUSE_BLK0,3);return(t>>9&7)+((t>>2&1)<<3)}async get_chip_revision(){const t=await this.read_efuse(this.EFUSE_BLK0,3),e=await this.read_efuse(this.EFUSE_BLK0,5),i=await this.read_reg(this.DR_REG_SYSCON_BASE+124),s=t>>15&1,n=e>>20&1,a=i>>31&1;return s?n?a?3:2:1:0}async get_chip_description(){const t=await this.get_pkg_version(),e=await this.get_chip_revision(),i=3==e,s=1&await this.read_efuse(this.EFUSE_BLK0,3);let n={0:s?"ESP32-S0WDQ6":"ESP32-D0WDQ6",1:s?"ESP32-S0WD":"ESP32-D0WD",2:"ESP32-D2WD",4:"ESP32-U4WDH",5:i?"ESP32-PICO-V3":"ESP32-PICO-D4",6:"ESP32-PICO-V3-02"}[t]||"unknown ESP32";return n.startsWith("ESP32-D0WD")&&i&&(n+="-V3"),`${n} (revision ${e})`}}(0,k.Z)(et,"CHIP_DETECT_MAGIC_VALUE",[15736195]);class it extends et{constructor(...t){super(...t),(0,k.Z)(this,"FLASH_WRITE_SIZE",16384),(0,k.Z)(this,"STATUS_BYTES_LENGTH",2),(0,k.Z)(this,"IS_STUB",!0)}}class st extends et{constructor(...t){super(...t),(0,k.Z)(this,"CHIP_NAME","ESP32-S2"),(0,k.Z)(this,"EFUSE_BASE",1061265408),(0,k.Z)(this,"EFUSE_BLK0",this.EFUSE_BASE+48),(0,k.Z)(this,"EFUSE_BLK1",this.EFUSE_BASE+68),(0,k.Z)(this,"STUB_CLASS",nt)}async load_stub(){return await i.e(685).then(i.t.bind(i,8531,23))}async get_pkg_version(){const t=await this.read_efuse(this.EFUSE_BLK1,3);return t>>21&15}async get_chip_description(){return{0:"ESP32-S2",1:"ESP32-S2FH16",2:"ESP32-S2FH32"}[await this.get_pkg_version()]||"unknown ESP32-S2"}}(0,k.Z)(st,"CHIP_DETECT_MAGIC_VALUE",[1990]);class nt extends st{constructor(...t){super(...t),(0,k.Z)(this,"FLASH_WRITE_SIZE",16384),(0,k.Z)(this,"STATUS_BYTES_LENGTH",2),(0,k.Z)(this,"IS_STUB",!0)}}class at extends et{constructor(...t){super(...t),(0,k.Z)(this,"CHIP_NAME","ESP32-C3"),(0,k.Z)(this,"EFUSE_BASE",1610647552),(0,k.Z)(this,"EFUSE_BLK0",this.EFUSE_BASE+48),(0,k.Z)(this,"EFUSE_BLK1",this.EFUSE_BASE+68),(0,k.Z)(this,"STUB_CLASS",rt)}async load_stub(){return await i.e(784).then(i.t.bind(i,4347,23))}async get_pkg_version(){const t=await this.read_efuse(this.EFUSE_BLK1,3);return t>>21&7}async get_chip_revision(){const t=await this.read_efuse(this.EFUSE_BLK1,3);return t>>18&7}async get_chip_description(){const t={0:"ESP32-C3"}[await this.get_pkg_version()]||"unknown ESP32-C3",e=await this.get_chip_revision();return`${t} (revision ${e})`}}(0,k.Z)(at,"CHIP_DETECT_MAGIC_VALUE",[1763790959,456216687]);class rt extends at{constructor(...t){super(...t),(0,k.Z)(this,"FLASH_WRITE_SIZE",16384),(0,k.Z)(this,"STATUS_BYTES_LENGTH",2),(0,k.Z)(this,"IS_STUB",!0)}}const ot=115200,lt=96e4,ct=[Q,et,st,at];class ht extends(H()){constructor(...t){super(...t),(0,k.Z)(this,"serial",null),(0,k.Z)(this,"loader",null)}async open(t){this.serial=t;try{await this.serial.open({baudRate:ot});const t=new X(this.serial);t.start(),await t.connect();const e=await t.read_reg(X.CHIP_DETECT_MAGIC_REG_ADDR);for(const n of ct)n.CHIP_DETECT_MAGIC_VALUE.includes(e)&&(this.loader=new n(this.serial));if(await t.release(),!this.loader)throw new Error("Unsupported chip");this.loader.start();const i=await this.loader.get_chip_description();console.log(`Detected ${i}`),this.emit("connect",{chip_description:i});const s=await this.loader.run_stub();if(!s)return;await this.loader.release(),this.loader=s,this.loader.start(),await this.loader.change_baud(lt,ot),await N(100),await this.loader.release(),await this.serial.close(),await this.serial.open({baudRate:lt}),this.loader.start()}catch(e){throw console.warn("Failed launching loader",e),await this.serial.close(),this.serial=null,e}}async close(){this.loader&&(await this.loader.release(),this.loader=null),this.serial&&(await this.serial.close(),this.serial=null)}async flash(t){await(this.loader?.flash(t,(t=>this.emit("progress",t)))),await(this.loader?.hard_reset())}}var _t=ht;const ut=(0,a._)("h1",null,"Web ESPTool",-1),dt={class:"ant-upload-drag-icon"},Et={key:0,class:"ant-upload-text file"},ft={key:1,class:"ant-upload-text"},St=(0,a.Uk)("开始烧录"),pt=(0,a._)("div",null,"Copyright © 2021-2022 XiNGRZ",-1),wt=(0,a._)("div",null,[(0,a._)("a",{href:"https://github.com/xingrz/web-esptool"},"Fork me on GitHub")],-1),gt=[pt,wt];var vt=(0,a.aZ)({setup(t){const e=16777216,i=(0,r.iH)(null),s=(0,r.iH)(null),n=(0,r.iH)("idle");let _=null,u=[],d=0;const E=(0,a.Fl)((()=>"flashing"==n.value?.7:"connecting"==n.value?.4:null!=s.value&&s.value>=100?0:.2)),f=(0,a.Fl)((()=>null==s.value?.02:.02+s.value/100*1.1)),S=new _t;async function p(t){t.size>=e?l.ZP.error(`文件过大: ${Math.round(t.size/1024/1024)} MB`):(_=await B(t),null!=_?(i.value=t,u=_.partitions.map((({image:t})=>t.length)),d=u.reduce(((t,e)=>t+e),0)):l.ZP.error("该文件不是一个合法的固件包"))}async function w(){n.value="connecting",s.value=0;try{const t=await navigator.serial.requestPort();await S.open(t)}catch(t){return l.ZP.error("设备打开失败"),void(n.value="idle")}n.value="flashing";try{await S.flash(_)}catch(t){console.error(t),l.ZP.error("烧录失败")}await S.close(),console.log("done"),n.value="idle"}return S.on("connect",(({chip_description:t})=>{console.log(`Connected: ${t}`),l.ZP.success(`已连接：${t}`)})),S.on("progress",(({index:t,blocks_written:e,blocks_total:i})=>{let n=0;for(let s=0;s<t;s++)n+=u[s];const a=n+u[t]*(e/i);s.value=Math.min(100,a/d*100)})),(t,e)=>{const l=(0,a.up)("a-upload-dragger"),_=(0,a.up)("a-button");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a.Wm)(L,{peak:(0,r.SU)(E),level:(0,r.SU)(f),period:500},null,8,["peak","level"]),(0,a._)("div",{class:(0,o.C_)(t.$style.content)},[ut,(0,a._)("div",{class:(0,o.C_)(t.$style.author)},"by XiNGRZ",2),null==s.value?((0,a.wg)(),(0,a.iD)("div",{key:0,class:(0,o.C_)([t.$style.main,t.$style.upload])},[(0,a.Wm)(l,{accept:".zip",showUploadList:!1,customRequest:({file:t})=>p(t),class:(0,o.C_)(t.$style.upload)},{default:(0,a.w5)((()=>[(0,a._)("p",dt,[i.value?((0,a.wg)(),(0,a.j4)((0,r.SU)(c.Z),{key:0})):((0,a.wg)(),(0,a.j4)((0,r.SU)(h.Z),{key:1}))]),i.value?((0,a.wg)(),(0,a.iD)("p",Et,(0,o.zw)(i.value.name),1)):((0,a.wg)(),(0,a.iD)("p",ft,"点击选择或将固件包拖放到此处"))])),_:1},8,["customRequest","class"])],2)):(0,a.kq)("",!0),null!=s.value?((0,a.wg)(),(0,a.iD)("div",{key:1,class:(0,o.C_)([t.$style.main,t.$style.progress])},(0,o.zw)(Math.floor(s.value||0))+"%",3)):(0,a.kq)("",!0),(0,a._)("div",{class:(0,o.C_)(t.$style.buttons)},["flashing"!=n.value?((0,a.wg)(),(0,a.j4)(_,{key:0,size:"large",type:null!=s.value&&100==Math.floor(s.value)?"default":"primary",ghost:null!=s.value&&100==Math.floor(s.value),disabled:!i.value,loading:"connecting"==n.value,onClick:w},{default:(0,a.w5)((()=>[St])),_:1},8,["type","ghost","disabled","loading"])):(0,a.kq)("",!0)],2)],2),(0,a._)("div",{class:(0,o.C_)(t.$style.footer)},gt,2)],64)}}}),mt={content:"App_content_d8048",author:"App_author_abbde",main:"App_main_d0312",upload:"App_upload_d7963",progress:"App_progress_a7caa",buttons:"App_buttons_c4f4b",footer:"App_footer_f80f0"};const At={};At["$style"]=mt;const Lt=(0,f.Z)(vt,[["__cssModules",At]]);var yt=Lt;(0,s.ri)(yt).use(n.ZP).mount("#app")},8752:function(){},9862:function(){},964:function(){},7504:function(){}},e={};function i(s){var n=e[s];if(void 0!==n)return n.exports;var a=e[s]={exports:{}};return t[s].call(a.exports,a,a.exports,i),a.exports}i.m=t,function(){var t=[];i.O=function(e,s,n,a){if(!s){var r=1/0;for(h=0;h<t.length;h++){s=t[h][0],n=t[h][1],a=t[h][2];for(var o=!0,l=0;l<s.length;l++)(!1&a||r>=a)&&Object.keys(i.O).every((function(t){return i.O[t](s[l])}))?s.splice(l--,1):(o=!1,a<r&&(r=a));if(o){t.splice(h--,1);var c=n();void 0!==c&&(e=c)}}return e}a=a||0;for(var h=t.length;h>0&&t[h-1][2]>a;h--)t[h]=t[h-1];t[h]=[s,n,a]}}(),function(){i.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return i.d(e,{a:e}),e}}(),function(){var t,e=Object.getPrototypeOf?function(t){return Object.getPrototypeOf(t)}:function(t){return t.__proto__};i.t=function(s,n){if(1&n&&(s=this(s)),8&n)return s;if("object"===typeof s&&s){if(4&n&&s.__esModule)return s;if(16&n&&"function"===typeof s.then)return s}var a=Object.create(null);i.r(a);var r={};t=t||[null,e({}),e([]),e(e)];for(var o=2&n&&s;"object"==typeof o&&!~t.indexOf(o);o=e(o))Object.getOwnPropertyNames(o).forEach((function(t){r[t]=function(){return s[t]}}));return r["default"]=function(){return s},i.d(a,r),a}}(),function(){i.d=function(t,e){for(var s in e)i.o(e,s)&&!i.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})}}(),function(){i.f={},i.e=function(t){return Promise.all(Object.keys(i.f).reduce((function(e,s){return i.f[s](t,e),e}),[]))}}(),function(){i.u=function(t){return"js/"+{458:"stub_flasher_32",468:"stub_flasher_8266",685:"stub_flasher_32s2",784:"stub_flasher_32c3"}[t]+"."+{458:"cb8cdef5",468:"2f55f7fe",685:"f6addc29",784:"6ac6beba"}[t]+".js"}}(),function(){i.miniCssF=function(t){}}(),function(){i.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){var t={},e="web-esptool:";i.l=function(s,n,a,r){if(t[s])t[s].push(n);else{var o,l;if(void 0!==a)for(var c=document.getElementsByTagName("script"),h=0;h<c.length;h++){var _=c[h];if(_.getAttribute("src")==s||_.getAttribute("data-webpack")==e+a){o=_;break}}o||(l=!0,o=document.createElement("script"),o.charset="utf-8",o.timeout=120,i.nc&&o.setAttribute("nonce",i.nc),o.setAttribute("data-webpack",e+a),o.src=s),t[s]=[n];var u=function(e,i){o.onerror=o.onload=null,clearTimeout(d);var n=t[s];if(delete t[s],o.parentNode&&o.parentNode.removeChild(o),n&&n.forEach((function(t){return t(i)})),e)return e(i)},d=setTimeout(u.bind(null,void 0,{type:"timeout",target:o}),12e4);o.onerror=u.bind(null,o.onerror),o.onload=u.bind(null,o.onload),l&&document.head.appendChild(o)}}}(),function(){i.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}}(),function(){i.p="/"}(),function(){var t={143:0};i.f.j=function(e,s){var n=i.o(t,e)?t[e]:void 0;if(0!==n)if(n)s.push(n[2]);else{var a=new Promise((function(i,s){n=t[e]=[i,s]}));s.push(n[2]=a);var r=i.p+i.u(e),o=new Error,l=function(s){if(i.o(t,e)&&(n=t[e],0!==n&&(t[e]=void 0),n)){var a=s&&("load"===s.type?"missing":s.type),r=s&&s.target&&s.target.src;o.message="Loading chunk "+e+" failed.\n("+a+": "+r+")",o.name="ChunkLoadError",o.type=a,o.request=r,n[1](o)}};i.l(r,l,"chunk-"+e,e)}},i.O.j=function(e){return 0===t[e]};var e=function(e,s){var n,a,r=s[0],o=s[1],l=s[2],c=0;if(r.some((function(e){return 0!==t[e]}))){for(n in o)i.o(o,n)&&(i.m[n]=o[n]);if(l)var h=l(i)}for(e&&e(s);c<r.length;c++)a=r[c],i.o(t,a)&&t[a]&&t[a][0](),t[r[c]]=0;return i.O(h)},s=self["webpackChunkweb_esptool"]=self["webpackChunkweb_esptool"]||[];s.forEach(e.bind(null,0)),s.push=e.bind(null,s.push.bind(s))}();var s=i.O(void 0,[998],(function(){return i(7396)}));s=i.O(s)})();
//# sourceMappingURL=app.18afccd9.js.map